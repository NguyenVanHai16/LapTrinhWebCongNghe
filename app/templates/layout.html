<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechMart</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
    {% block styles %}
    {% endblock %}
</head>
<body>
    <header class="navbar">
        <div class="container navbar-container">
            <a href="/" class="logo-text">TechMart</a>
            <form id="search-form" class="search-form" action="{{ url_for('products.all_products') }}" method="GET">
                <div class="search-container">
                    <input type="text" name="search" class="search-input" placeholder="Tìm kiếm sản phẩm..." value="{{ request.args.get('search', '') }}">
                    <button type="submit" class="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </form>
            <button class="toggle-menu">
                <i class="fas fa-bars"></i>
            </button>
            <ul class="nav-links">
                <li><a href="/">Trang chủ</a></li>
                <li><a href="/products">Sản phẩm</a></li>
                <li><a href="/about">Về chúng tôi</a></li>
                <li><a href="/contact">Liên hệ</a></li>
                <li>
                    <div class="custom-dropdown">
                        <button class="custom-toggle">
                            <span class="avatar-mini">
                                {% if current_user.is_authenticated %}
                                    {{ current_user.first_name[0] if current_user.first_name else current_user.username[0] }}
                                {% else %}
                                    <i class="fas fa-user"></i>
                                {% endif %}
                            </span>
                            <span class="user-name-display">
                                {% if current_user.is_authenticated %}
                                    {{ current_user.first_name if current_user.first_name else current_user.username }}
                                {% else %}
                                    Tài khoản
                                {% endif %}
                            </span>
                            <i class="fas fa-chevron-down custom-icon"></i>
                        </button>
                        <div class="custom-menu">
                            {% if current_user.is_authenticated %}
                                <a href="/profile" class="custom-item"><i class="fas fa-user"></i> Thông tin tài khoản</a>
                                <a href="/change-password" class="custom-item"><i class="fas fa-lock"></i> Đổi mật khẩu</a>
                                <a href="/cart" class="custom-item"><i class="fas fa-shopping-cart"></i> Giỏ hàng</a>
                                <a href="/orders" class="custom-item"><i class="fas fa-box"></i> Đơn mua</a>
                                <a href="/order-history" class="custom-item"><i class="fas fa-history"></i> Lịch sử đơn hàng</a>
                                {% if current_user.is_admin %}
                                    <div class="custom-divider"></div>
                                    <a href="/admin/products" class="custom-item"><i class="fas fa-cogs"></i> Quản trị sản phẩm</a>
                                {% endif %}
                                <div class="custom-divider"></div>
                                <a href="/logout" class="custom-item"><i class="fas fa-sign-out-alt"></i> Đăng xuất</a>
                            {% else %}
                                <a href="/login" class="custom-item"><i class="fas fa-sign-in-alt"></i> Đăng nhập</a>
                                <a href="/register" class="custom-item"><i class="fas fa-user-plus"></i> Đăng ký</a>
                            {% endif %}
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </header>

    {% if request.path.startswith('/products') %}
        <section class="filter-section">
            {% block filter %}
            {% endblock %}
        </section>
    {% endif %}

    <main class="container">
        {% block content %}
        {% endblock %}
    </main>

    <footer class="footer">
        <div class="container footer-content">
            <div class="footer-logo">
                <a href="/" class="logo-text">TechMart</a>
                <p>Đưa công nghệ đến gần bạn hơn.</p>
            </div>
            <div class="footer-links">
                <div class="footer-column">
                    <h3>Thông tin</h3>
                    <ul>
                        <li><a href="/about">Về chúng tôi</a></li>
                        <li><a href="/terms">Điều khoản sử dụng</a></li>
                        <li><a href="/privacy">Chính sách bảo mật</a></li>
                        <li><a href="/contact">Liên hệ</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Danh mục</h3>
                    <ul>
                        <li><a href="/products/phones">Điện thoại</a></li>
                        <li><a href="/products/laptops">Laptop</a></li>
                        <li><a href="/products/tablets">Máy tính bảng</a></li>
                        <li><a href="/products/accessories">Phụ kiện</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Hỗ trợ</h3>
                    <ul>
                        <li><a href="/guide">Hướng dẫn mua hàng</a></li>
                        <li><a href="/payment">Phương thức thanh toán</a></li>
                        <li><a href="/shipping">Chính sách vận chuyển</a></li>
                        <li><a href="/warranty">Chính sách bảo hành</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Liên hệ</h3>
                    <div class="footer-contact">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Đường 3/2, Phường Tích Lương, TP Thái Nguyên</span>
                    </div>
                    <div class="footer-contact">
                        <i class="fas fa-phone"></i>
                        <span>0123.456.789</span>
                    </div>
                    <div class="footer-contact">
                        <i class="fas fa-envelope"></i>
                        <span>support@techmart.com</span>
                    </div>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            © 2025 TechMart. Tất cả các quyền được bảo lưu.
        </div>
    </footer>

    <div class="chatbot-toggle">
        <i class="fas fa-comment-dots"></i>
    </div>
    <div class="chatbot-window">
        <div class="chatbot-header">
            <h3>TechBot</h3>
            <button class="chatbot-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="chatbot-body">
            <div class="chatbot-messages">
                <p>Chào bạn! Tôi là TechBot, trợ lý ảo của TechMart. Hãy hỏi tôi bất cứ điều gì!</p>
            </div>
        </div>
        <div class="chatbot-footer">
            <input type="text" class="chatbot-input" placeholder="Nhập tin nhắn...">
            <button class="chatbot-send">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    {% block scripts %}
        <script src="{{ url_for('static', filename='js/chatbot_new.js') }}"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Xử lý dropdown
                const dropdownToggle = document.querySelector('.custom-toggle');
                const dropdownMenu = document.querySelector('.custom-menu');

                if (dropdownToggle && dropdownMenu) {
                    dropdownToggle.addEventListener('click', function (e) {
                        e.stopPropagation();
                        dropdownMenu.classList.toggle('show');
                    });

                    // Đóng dropdown khi nhấn ra ngoài
                    document.addEventListener('click', function (e) {
                        if (!dropdownToggle.contains(e.target) && !dropdownMenu.contains(e.target)) {
                            dropdownMenu.classList.remove('show');
                        }
                    });
                }

                // Debug form tìm kiếm
                const searchForm = document.getElementById('search-form');
                if (searchForm) {
                    searchForm.addEventListener('submit', function(event) {
                        const searchInput = document.querySelector('.search-input');
                        const searchValue = searchInput.value.trim();
                        console.log('Search form submitted with value:', searchValue);
                        if (!searchValue) {
                            console.warn('Search input is empty!');
                        }
                    });
                }
            });
        </script>
    {% endblock %}
</body>
</html>
```